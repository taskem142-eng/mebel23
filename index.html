<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Мебельный каталог</title>
    <style>
        body { font-family: sans-serif; background: #f0f2f5; margin: 0; padding: 20px; color: #333; }
        h1 { text-align: center; color: #2c3e50; }
        
        /* Стили фильтров */
        #filters { display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; margin-bottom: 30px; }
        .filter-btn { padding: 10px 15px; background: #fff; border: 1px solid #ddd; border-radius: 20px; cursor: pointer; transition: 0.3s; }
        .filter-btn.active { background: #007bff; color: #fff; border-color: #007bff; }

        /* Сетка товаров */
        .container { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; }
        .card { background: #fff; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 15px rgba(0,0,0,0.08); display: flex; flex-direction: column; }
        
        /* Слайдер картинок */
        .gallery { display: flex; overflow-x: auto; scroll-snap-type: x mandatory; height: 220px; background: #eee; }
        .gallery img { width: 100%; height: 100%; object-fit: cover; flex-shrink: 0; scroll-snap-align: start; }
        .gallery::-webkit-scrollbar { height: 4px; }
        .gallery::-webkit-scrollbar-thumb { background: #ccc; border-radius: 10px; }

        .info { padding: 15px; flex-grow: 1; display: flex; flex-direction: column; }
        .info h3 { font-size: 15px; margin: 0 0 10px; height: 36px; overflow: hidden; line-height: 1.2; }
        .price { font-size: 20px; font-weight: bold; color: #2ecc71; margin-top: auto; }
        .cat-name { font-size: 12px; color: #888; margin-bottom: 5px; text-transform: uppercase; }
    </style>
</head>
<body>

    <h1>Каталог мебели</h1>
    <div id="filters"><button class="filter-btn active" onclick="filterCat('all')">Все</button></div>
    <div id="catalog" class="container">Загрузка данных...</div>

    <script>
        let allOffers = [];
        const categories = {};

        fetch('pricelist.xml')
            .then(res => res.text())
            .then(xmlStr => {
                const parser = new DOMParser();
                const xml = parser.parseFromString(xmlStr, "text/xml");

                // 1. Собираем категории
                const cats = xml.getElementsByTagName("category");
                for (let cat of cats) {
                    categories[cat.getAttribute("id")] = cat.textContent;
                }

                // 2. Создаем кнопки фильтров
                const filterContainer = document.getElementById('filters');
                for (let id in categories) {
                    const btn = document.createElement('button');
                    btn.className = 'filter-btn';
                    btn.textContent = categories[id];
                    btn.onclick = (e) => filterCat(id, e.target);
                    filterContainer.appendChild(btn);
                }

                // 3. Собираем товары
                const offers = xml.getElementsByTagName("offer");
                for (let off of offers) {
                    allOffers.push({
                        id: off.getAttribute("id"),
                        catId: off.getElementsByTagName("categoryId")[0].textContent,
                        name: off.getElementsByTagName("name")[0].textContent,
                        price: off.getElementsByTagName("price")[0].textContent,
                        pics: Array.from(off.getElementsByTagName("picture")).map(p => p.textContent)
                    });
                }
                render(allOffers);
            });

        function render(items) {
            const container = document.getElementById('catalog');
            container.innerHTML = items.map(item => `
                <div class="card">
                    <div class="gallery">
                        ${item.pics.map(p => `<img src="${p}" loading="lazy">`).join('')}
                    </div>
                    <div class="info">
                        <div class="cat-name">${categories[item.catId] || ''}</div>
                        <h3>${item.name}</h3>
                        <div class="price">${item.price} ₽</div>
                    </div>
                </div>
            `).join('');
        }

        function filterCat(id, btn) {
            // Подсветка кнопок
            document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
            if(btn) btn.classList.add('active'); else document.querySelector('.filter-btn').classList.add('active');

            if (id === 'all') {
                render(allOffers);
            } else {
                render(allOffers.filter(o => o.catId === id));
            }
        }
    </script>
</body>
</html>